<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (c) 2011 Evolveum                             -->
<!--                                                         -->
<!-- The contents of this file are subject to the terms      -->
<!-- of the Common Development and Distribution License      -->
<!-- (the License). You may not use this file except in      -->
<!-- compliance with the License.                            -->
<!--                                                         -->
<!-- You can obtain a copy of the License at                 -->
<!-- http://www.opensource.org/licenses/cddl1 or             -->
<!-- CDDLv1.0.txt file in the source code distribution.      -->
<!-- See the License for the specific language governing     -->
<!-- permission and limitations under the License.           -->
<!--                                                         -->
<!-- If applicable, add the following below the CDDL Header, -->
<!-- with the fields enclosed by brackets [] replaced by     -->
<!-- your own identifying information:                       -->
<!--                                                         -->
<!-- Portions Copyrighted 2011 [name of copyright owner]     -->
<!-- Portions Copyrighted 2011 lazyman                       -->
<!--                                                         -->
<object xsi:type="ResourceType" oid="10000000-0000-0000-0000-000000000003" 
	xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-2a"
	xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-2a"
	xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003"
	xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-2"
	xmlns:r="http://midpoint.evolveum.com/xml/ns/public/resource/annotation-2" 
	xmlns:ds="http://www.w3.org/2000/09/xmldsig#"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema"
	xmlns:enc="http://www.w3.org/2001/04/xmlenc#">
	<name>Localhost OpenDJ Complex</name>
	<connectorRef oid="14e63399-8869-4787-9369-93f9d1311671" type="ConnectorType">
		<and xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-2" xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-2a"
			xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003"
			xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:my="http://myself.me/schemas/whatever">
			<c:type uri="http://midpoint.evolveum.com/xml/ns/public/common/common-2a#ConnectorType" />
			<c:equal>
				<c:value>
					<c:connectorType>org.identityconnectors.ldap.LdapConnector</c:connectorType>
				</c:value>
			</c:equal>
		</and>
	</connectorRef>
	<connectorConfiguration>
		<icfcldap:configurationProperties xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-2"
			xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-2" xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-2a"
			xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003"
			xmlns:xsd="http://www.w3.org/2001/XMLSchema"
			xmlns:icfcldap="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/org.identityconnectors.ldap/org.identityconnectors.ldap.LdapConnector"
			xmlns:my="http://myself.me/schemas/whatever">
			<icfcldap:port>1389</icfcldap:port>
			<icfcldap:host>localhost</icfcldap:host>
			<icfcldap:baseContexts>dc=example,dc=com</icfcldap:baseContexts>
			<icfcldap:principal>uid=idm,ou=Administrators,dc=example,dc=com</icfcldap:principal>
			<icfcldap:credentials>
				<enc:EncryptedData Type="http://www.w3.org/2001/04/xmlenc#Element">
					<enc:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes256-cbc" />
					<ds:KeyInfo>
						<ds:KeyName>HF6JRsNMeJt6alihT44CXKgpe0c=</ds:KeyName>
					</ds:KeyInfo>
					<enc:CipherData>
						<enc:CipherValue>lg0Z08KE4rsE8GGvQsTqSMD1v7Id/sQAGg8f8VaA2jvwnno2f6vBkZbsDuYK8p9Y</enc:CipherValue>
					</enc:CipherData>
				</enc:EncryptedData>
			</icfcldap:credentials>
			<icfcldap:modifiersNamesToFilterOut>uid=idm,ou=Administrators,dc=example,dc=com</icfcldap:modifiersNamesToFilterOut>
			<icfcldap:vlvSortAttribute>uid</icfcldap:vlvSortAttribute>
			<icfcldap:usePagedResultControl>true</icfcldap:usePagedResultControl>
		</icfcldap:configurationProperties>
		<icfc:connectorPoolConfiguration xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-2"
			xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-2" xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-2a"
			xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003"
			xmlns:xsd="http://www.w3.org/2001/XMLSchema"
			xmlns:icfcldap="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/org.identityconnectors.ldap/org.identityconnectors.ldap.LdapConnector"
			xmlns:my="http://myself.me/schemas/whatever">
			<icfc:minEvictableIdleTimeMillis>120000</icfc:minEvictableIdleTimeMillis>
			<icfc:minIdle>1</icfc:minIdle>
			<icfc:maxIdle>10</icfc:maxIdle>
			<icfc:maxObjects>10</icfc:maxObjects>
			<icfc:maxWait>150000</icfc:maxWait>
		</icfc:connectorPoolConfiguration>
		<icfc:producerBufferSize xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-2"
			xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-2" xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-2a"
			xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003"
			xmlns:xsd="http://www.w3.org/2001/XMLSchema"
			xmlns:icfcldap="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/org.identityconnectors.ldap/org.identityconnectors.ldap.LdapConnector"
			xmlns:my="http://myself.me/schemas/whatever">100</icfc:producerBufferSize>
	</connectorConfiguration>
	<namespace>http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003</namespace>
	<schema>
	  <definition>
		<xsd:schema elementFormDefault="qualified"
			targetNamespace="http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003"
			xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-2" 
			xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-2a"
			xmlns:a="http://prism.evolveum.com/xml/ns/public/annotation-2" 
			xmlns:xsd="http://www.w3.org/2001/XMLSchema">
			<xsd:import namespace="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-2" />
			
			<xsd:import namespace="http://prism.evolveum.com/xml/ns/public/annotation-2" />
			<xsd:complexType name="GroupObjectClass">
				<xsd:annotation>
					<xsd:appinfo>
						<r:resourceObject />
						<r:identifier ref="icfs:uid" />
						<r:displayName ref="icfs:name" />
						<r:namingAttribute ref="icfs:name" />
						<r:nativeObjectClass>__GROUP__</r:nativeObjectClass>
					</xsd:appinfo>
				</xsd:annotation>
				<xsd:sequence>
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="seeAlso" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="owner" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="o" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="description" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="objectClass" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="uniqueMember" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" name="cn" type="xsd:string" />
					<xsd:element ref="icfs:name" />
					<xsd:element ref="icfs:uid" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="businessCategory" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="ou" type="xsd:string" />
				</xsd:sequence>
			</xsd:complexType>
			<xsd:complexType name="AccountObjectClass">
				<xsd:annotation>
					<xsd:appinfo>
						<r:account />
						<r:resourceObject />
						<r:identifier ref="icfs:uid" />
						<r:displayName ref="icfs:name" />
						<r:namingAttribute ref="icfs:name" />
						<r:nativeObjectClass>__ACCOUNT__</r:nativeObjectClass>
						<r:default/>
					</xsd:appinfo>
				</xsd:annotation>
				<xsd:sequence>
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="internationaliSDNNumber" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="x121Address" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="employeeType" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="pager" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="audio" type="xsd:base64Binary" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="departmentNumber" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="x500UniqueIdentifier" type="xsd:base64Binary" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="postalAddress" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="objectClass" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="givenName" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="mail" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="photo" type="xsd:base64Binary" />
					<xsd:element minOccurs="0" name="displayName" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" name="cn" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="userPassword" type="xsd:base64Binary" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="physicalDeliveryOfficeName" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="manager" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="homePhone" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="description" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="postOfficeBox" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="homePostalAddress" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="roomNumber" type="xsd:string" />
					<xsd:element minOccurs="0" name="employeeNumber" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="facsimileTelephoneNumber" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="userSMIMECertificate" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="l" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="userCertificate" type="xsd:base64Binary" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="teletexTerminalIdentifier" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="jpegPhoto" type="xsd:base64Binary" />
					<xsd:element ref="icfs:name" />
					<xsd:element minOccurs="0" name="preferredDeliveryMethod" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="userPKCS12" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="postalCode" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="labeledURI" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="telexNumber" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="carLicense" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="street" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="registeredAddress" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" name="sn" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="seeAlso" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="secretary" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="mobile" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="uid" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="initials" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="businessCategory" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="telephoneNumber" type="xsd:string" />
					<xsd:element ref="icfs:uid" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="o" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="title" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="destinationIndicator" type="xsd:string" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="st" type="xsd:string" />
					<xsd:element minOccurs="0" ref="icfs:password" />
					<xsd:element maxOccurs="unbounded" minOccurs="0" name="ou" type="xsd:string" />
					<xsd:element minOccurs="0" name="preferredLanguage" type="xsd:string" />
					<xsd:element minOccurs="0" name="ds-pwp-account-disabled" type="xsd:string">
						<xsd:annotation>
							<xsd:appinfo>
								<a:ignore/>
							</xsd:appinfo>
						</xsd:annotation>
					</xsd:element>
				</xsd:sequence>
			</xsd:complexType>
		</xsd:schema>
	  </definition>
	</schema>
	<schemaHandling>
		<accountType>
			<name>default</name>
			<displayName>Default Account</displayName>
			<default>true</default>
			<objectClass>ri:AccountObjectClass</objectClass>
			<attribute>
				<ref>icfs:name</ref>
				<displayName>Distinguished Name</displayName>
				<access>create</access>
				<access>read</access>
				<outbound>
				    <strength>weak</strength>
					<expression>
						<code>
							concat('uid=', $c:user/c:name, ',ou=people,dc=example,dc=com')
						</code>
					</expression>
				</outbound>
			</attribute>
			<attribute>
				<ref>icfs:uid</ref>
				<displayName>Entry UUID</displayName>
				<access>read</access>
			</attribute>
			<attribute>
				<ref>ri:cn</ref>
				<displayName>Common Name</displayName>
				<maxOccurs>1</maxOccurs>
				<access>create</access>
				<access>read</access>
				<access>update</access>
				<outbound>
					<expression>
						<code>
							$c:user/c:fullName
						</code>
					</expression>
				</outbound>
				<inbound>
					<target>
						$c:user/c:fullName
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:sn</ref>
				<displayName>Surname</displayName>
				<access>create</access>
				<access>read</access>
				<access>update</access>
				<outbound>
					<expression>
						<code>
							$c:user/c:familyName
						</code>
					</expression>
				</outbound>
				<inbound>
					<target>
						$c:user/c:familyName
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:givenName</ref>
				<displayName>Given Name</displayName>
				<access>create</access>
				<access>read</access>
				<access>update</access>
				<outbound>
					<expression>
						<code>
							$c:user/c:givenName
						</code>
					</expression>
				</outbound>
				<inbound>
					<target>
						$c:user/c:givenName
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:uid</ref>
				<displayName>Login Name</displayName>
				<access>create</access>
				<access>read</access>
				<outbound>
					<expression>
						<code>
							$c:user/c:name
						</code>
					</expression>
				</outbound>
				<inbound>
					<target>
						$c:user/c:name
                    </target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:description</ref>
				<outbound>
					<strength>weak</strength>
					<value>Created by IDM</value>
				</outbound>
				<inbound>
					<!-- c:valueFilter type="http://midpoint.evolveum.com/xml/ns/public/common/value-filter-1.xsd#patternFilter"
						xmlns:f="http://midpoint.evolveum.com/xml/ns/public/common/value-filter-1.xsd">
						<f:replace>
							<f:pattern>\p{C}</f:pattern>
							<f:replacement />
						</f:replace>
					</c:valueFilter>  -->
					<target>
						declare namespace my="http://whatever.com/my";
						$c:user/c:extension/my:description
                    </target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:l</ref>
				<outbound>
					<expression>
						<variable xmlns:my="http://myself.me/schemas/whatever">
							<name>my:defaultLocation</name>
							<value xsi:type="xsd:string">middle of nowhere</value>
						</variable>
						<c:code xmlns:my="http://myself.me/schemas/whatever">
								$my:defaultLocation
						</c:code>
					</expression>
				</outbound>
			</attribute>
			<attribute>
				<ref>ri:userPassword</ref>
				<ignore>true</ignore>
			</attribute>
			<protected>
				<icfs:name>uid=idm,ou=Administrators,dc=example,dc=com</icfs:name>
			</protected>
			<protected>
				<icfs:name>uid=root,ou=Administrators,dc=example,dc=com</icfs:name>
			</protected>
		</accountType>
	</schemaHandling>
		<synchronization>
		<enabled>true</enabled>
		<correlation>
			<equal xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-2a" xmlns:ids="http://midpoint.evolveum.com/xml/ns/public/resource/icf/schema-1.xsd"
				xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance/10000000-0000-0000-0000-000000000003"
				xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:my="http://myself.me/schemas/whatever">
				<path>.</path>
				<valueExpression>
					<ref>c:name</ref>
					<code>
						declare namespace dj="http://midpoint.evolveum.com/xml/ns/public/resource/instances/ef2bc95b-76e0-59e2-86d6-3d4f02d3ffff";
						$c:account/c:attributes/dj:uid
					</code>
				</valueExpression>
			</equal>
		</correlation>
		<reaction>
			<situation>confirmed</situation>
			<action ref="http://midpoint.evolveum.com/xml/ns/public/model/action-2#modifyUser" />
		</reaction>
		<reaction>
			<situation>deleted</situation>
			<action ref="http://midpoint.evolveum.com/xml/ns/public/model/action-2#unlinkAccount" />
		</reaction>
		<reaction>
			<situation>missing</situation>
			<action ref="http://midpoint.evolveum.com/xml/ns/public/model/action-2#addAccount" />
		</reaction>
		<reaction>
			<situation>found</situation>
			<action ref="http://midpoint.evolveum.com/xml/ns/public/model/action-2#linkAccount" />
		</reaction>
		<reaction>
			<situation>unassigned</situation>
			<action ref="http://midpoint.evolveum.com/xml/ns/public/model/action-2#linkAccount" />
		</reaction>
		<reaction>
			<situation>unmatched</situation>
			<action ref="http://midpoint.evolveum.com/xml/ns/public/model/action-2#addUser">
				<userTemplateRef oid="10000000-0000-0000-0000-000000000002"/>
			</action>
			<action ref="http://midpoint.evolveum.com/xml/ns/public/model/action-2#linkAccount" />
		</reaction>
	</synchronization>
</object>